---
description: SBS 검수 반려 (변경 요청 반영 → 재검수)
agent: atlas
---

## Plan Name 및 변경 요청 내용 파싱

`$ARGUMENTS`로부터 plan name과 변경 요청 내용을 결정해라:

1. **`$ARGUMENTS`가 비어있으면**: 에러 메시지 출력 후 종료
   ```
   "변경 요청 내용을 입력해주세요: `/sbs-reject {변경 요청 내용}` 또는 `/sbs-reject {plan-name} {변경 요청 내용}`"
   ```

2. **`$ARGUMENTS`의 첫 번째 토큰이 `.sisyphus/plans/` 내 플랜 이름과 일치하면**: 기존 방식
   - 첫 번째 토큰: `{PLAN_NAME}`
   - 나머지 전체 문자열: `<변경 요청 내용>`

3. **`$ARGUMENTS`의 첫 번째 토큰이 플랜 이름과 일치하지 않으면**: 자동 탐색
   - 전체 `$ARGUMENTS`를 `<변경 요청 내용>`으로 취급
   - `.sisyphus/plans/` 디렉토리에서 `- [ ]`(미완료 Task)가 존재하는 `.md` 파일을 찾아 자동 선택:
     - 플랜이 0개면: "❌ 진행 중인 플랜이 없습니다. `/sbs-plan`으로 새 플랜을 생성하세요." 출력 후 종료
     - 플랜이 1개면: 해당 플랜을 자동 선택
     - 플랜이 2개 이상이면: `question` 도구를 사용하여 선택
       - header: "플랜 선택"
       - question: "반려할 플랜을 선택하세요"
       - options: [플랜 이름 목록 (확장자 제외)]

위에서 결정된 plan name을 `{PLAN_NAME}`으로 사용해라.

## 반려 작업 시작

**작업 시작 전 반드시 아래 정보를 출력해라:**
```
- 플랜: {PLAN_NAME}
- 태스크: {반려 대상 Task 번호/제목}
```

`.sisyphus/plans/{PLAN_NAME}.md`에서 가장 최근 검수 요청된 미완료 Task(`- [ ]`)를 찾아라.

필수 규칙:
- 코드 변경을 최우선으로 수행하여 `<변경 요청 내용>`을 해당 Task 구현에 즉시 반영
- 변경 요청 영향 범위가 현재 Task를 넘어가면 플랜 파일의 관련 Task 설명/[GATE]를 필요한 만큼만 수정
- 영향이 없는 Task는 수정 금지
- 수정 후 즉시 멈추고 다음 Task 진행 금지
- 해당 Task의 `[GATE]` 기준으로 재검수 요청
- 사용자 approve 전 체크박스를 `- [x]`로 변경 금지 (`- [ ]` 유지)

재검수 요청에 반드시 포함:
- 수행한 Task 번호/제목
- 변경 요청 내용 요약
- 변경 파일 목록
- 변경 요약 (이전 대비 달라진 점)
- 실행한 검증 결과(가능하면 lint/typecheck/test 중 1개 이상)
- `[GATE]` 검수 포인트/성공 기준 체크리스트
